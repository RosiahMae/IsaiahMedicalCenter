<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clinic System Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="module">
        // Import Firebase modules
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, addDoc, setDoc, updateDoc, deleteDoc, onSnapshot, collection, query, where, getDocs, runTransaction, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Global Firebase and App variables
        let app;
        let db;
        let auth;
        let userId = 'unknown'; // Will be set after successful authentication
        let appId = 'default-app-id';
        let isAuthReady = false;

        // Current user's role (defaults to Guest)
        let currentUserRole = 'Guest';

        // State for managing UI tabs
        let activeTab = 'Patients';

        // --- Utility Functions ---

        /** Generates a firestore path for public data */
        const getPublicCollectionRef = (collectionName) => {
            if (!db) return null;
            return collection(db, `artifacts/${appId}/public/data/${collectionName}`);
        };

        /** Fetches the current user's role (using a simple public collection for roles) */
        const fetchUserRole = async (uid) => {
            const userDocRef = doc(getPublicCollectionRef('roles'), uid);
            try {
                const docSnap = await getDoc(userDocRef);
                // Assign Nurse role for demonstration if user is anonymous or new
                return docSnap.exists() ? docSnap.data().role : 'Nurse'; 
            } catch (e) {
                console.error("Error fetching user role:", e);
                return 'Guest';
            }
        };

        /** Shows a custom message box instead of alert() */
        const showMessage = (title, message, type = 'info') => {
            const modal = document.getElementById('message-modal');
            document.getElementById('modal-title').textContent = title;
            document.getElementById('modal-message').textContent = message;

            const titleElement = document.getElementById('modal-title');
            titleElement.className = 'text-xl font-semibold mb-2';
            if (type === 'error') {
                titleElement.classList.add('text-red-600');
            } else if (type === 'success') {
                titleElement.classList.add('text-green-600');
            } else {
                titleElement.classList.add('text-blue-600');
            }

            modal.classList.remove('hidden');
        };

        const hideMessage = () => {
            document.getElementById('message-modal').classList.add('hidden');
        };

        // --- Core Application Logic ---

        /** Initializes the dashboard after successful authentication */
        const initializeDashboard = async (appId, uid) => {
            console.log(`Dashboard initializing for UID: ${uid} in App: ${appId}`);

            // 1. Fetch the user's role
            currentUserRole = await fetchUserRole(uid);
            document.getElementById('current-role').textContent = `Role: ${currentUserRole}`;

            // 2. Set up initial UI based on role
            renderNavigation();
            
            // 3. Start real-time data listeners
            setupRealtimeListeners();

            // 4. Default to the appropriate view
            switchTab(currentUserRole === 'Admin' ? 'Inventory' : 'Patients');
        };
        
        /** Sets up all Firestore real-time listeners */
        const setupRealtimeListeners = () => {
            // Patients Listener
            onSnapshot(getPublicCollectionRef('patients'), (snapshot) => {
                const patients = [];
                snapshot.forEach(doc => patients.push({ id: doc.id, ...doc.data() }));
                renderPatients(patients);
            }, (error) => console.error("Patients snapshot failed:", error));

            // Inventory Listener
            onSnapshot(getPublicCollectionRef('inventory'), (snapshot) => {
                const items = [];
                snapshot.forEach(doc => items.push({ id: doc.id, ...doc.data() }));
                renderInventory(items);
            }, (error) => console.error("Inventory snapshot failed:", error));

            // Consultations Listener (Show recent 5 for a simple view)
            onSnapshot(query(getPublicCollectionRef('consultations')), (snapshot) => {
                const consultations = [];
                snapshot.forEach(doc => consultations.push({ id: doc.id, ...doc.data() }));
                renderConsultations(consultations);
            }, (error) => console.error("Consultations snapshot failed:", error));
        };

        // --- Data Manipulation Functions (CRUD) ---

        /** Adds a new patient (Nurse/Admin function) */
        const addPatient = async (name, dob, contact) => {
            if (currentUserRole === 'Guest') {
                showMessage('Access Denied', 'Only authenticated users can add patients.', 'error');
                return;
            }
            try {
                await addDoc(getPublicCollectionRef('patients'), {
                    name,
                    dob,
                    contact,
                    admissionDate: new Date().toISOString(),
                    status: 'Admitted'
                });
                showMessage('Success', `Patient ${name} admitted successfully.`, 'success');
                document.getElementById('patient-form').reset();
            } catch (e) {
                console.error("Error adding patient:", e);
                showMessage('Error', 'Failed to admit patient. Check console for details.', 'error');
            }
        };

        /** Updates the status of a patient */
        const updatePatientStatus = async (patientId, newStatus) => {
            if (!['Admin', 'Nurse'].includes(currentUserRole)) {
                showMessage('Access Denied', 'You do not have permission to update patient status.', 'error');
                return;
            }
            try {
                const docRef = doc(getPublicCollectionRef('patients'), patientId);
                await updateDoc(docRef, { status: newStatus });
                showMessage('Success', `Patient ${patientId.substring(0, 5)} status updated to ${newStatus}.`, 'success');
            } catch (e) {
                console.error("Error updating patient status:", e);
                showMessage('Error', 'Failed to update patient status.', 'error');
            }
        };

        /** Adds a consultation for a patient */
        const addConsultation = async (patientId, patientName, notes) => {
            if (!['Admin', 'Nurse'].includes(currentUserRole)) {
                showMessage('Access Denied', 'You do not have permission to record consultations.', 'error');
                return;
            }
            try {
                await addDoc(getPublicCollectionRef('consultations'), {
                    patientId,
                    patientName,
                    notes,
                    recordedBy: userId,
                    timestamp: new Date().toISOString(),
                    status: 'Completed' 
                });
                showMessage('Success', `Consultation recorded for ${patientName}.`, 'success');
                document.getElementById('consultation-notes').value = '';
            } catch (e) {
                console.error("Error recording consultation:", e);
                showMessage('Error', 'Failed to record consultation. Check console for details.', 'error');
            }
        };

        /** Updates inventory stock (Admin function) */
        const updateInventoryStock = async (itemId, change) => {
            if (currentUserRole !== 'Admin') {
                showMessage('Access Denied', 'Only Admins can update inventory.', 'error');
                return;
            }

            const itemRef = doc(getPublicCollectionRef('inventory'), itemId);

            try {
                await runTransaction(db, async (transaction) => {
                    const itemDoc = await transaction.get(itemRef);
                    if (!itemDoc.exists()) {
                        throw new Error("Item does not exist!");
                    }
                    const newStock = (itemDoc.data().stock || 0) + change;
                    if (newStock < 0) {
                         throw new Error("Stock cannot be negative.");
                    }
                    transaction.update(itemRef, { stock: newStock });
                });
                showMessage('Success', `Stock for ${itemId.substring(0, 5)} updated.`, 'success');
            } catch (e) {
                console.error("Error updating inventory:", e);
                showMessage('Error', `Failed to update inventory: ${e.message}`, 'error');
            }
        };

        // --- UI Rendering ---

        /** Renders the tab navigation based on the user's role */
        const renderNavigation = () => {
            const tabs = [
                { id: 'Patients', label: 'Patients', roles: ['Admin', 'Nurse', 'Guest'] },
                { id: 'Consultations', label: 'Consultations', roles: ['Admin', 'Nurse'] },
                { id: 'Inventory', label: 'Inventory Management', roles: ['Admin', 'Nurse'] },
            ];

            const navContainer = document.getElementById('tab-navigation');
            navContainer.innerHTML = '';

            tabs.filter(tab => tab.roles.includes(currentUserRole))
                .forEach(tab => {
                    const button = document.createElement('button');
                    button.textContent = tab.label;
                    button.onclick = () => switchTab(tab.id);
                    
                    const baseClasses = 'px-4 py-2 rounded-t-lg font-medium transition-colors duration-200';
                    const activeClasses = 'bg-white border-t border-x border-blue-500 text-blue-700';
                    const inactiveClasses = 'bg-gray-100 hover:bg-gray-200 text-gray-600';

                    button.className = activeTab === tab.id ? `${baseClasses} ${activeClasses}` : `${baseClasses} ${inactiveClasses}`;
                    navContainer.appendChild(button);
                });
        };

        /** Switches the content panel */
        const switchTab = (tabId) => {
            activeTab = tabId;
            renderNavigation(); 

            const panels = document.querySelectorAll('.tab-panel');
            panels.forEach(panel => panel.classList.add('hidden'));

            document.getElementById(`panel-${tabId}`).classList.remove('hidden');

            if (tabId === 'Inventory') {
                checkAndSeedInventory();
            }
        };

        /** Renders the list of patients */
        const renderPatients = (patients) => {
            const container = document.getElementById('patients-list');
            container.innerHTML = '';
            
            patients.sort((a, b) => new Date(b.admissionDate) - new Date(a.admissionDate)).forEach(p => {
                const statusColor = p.status === 'Discharged' ? 'bg-green-100 text-green-700' : 
                                    p.status === 'Admitted' ? 'bg-yellow-100 text-yellow-700' : 'bg-red-100 text-red-700';
                
                // Show actions only to authorized users
                const actionsHtml = ['Admin', 'Nurse'].includes(currentUserRole) ? `
                        <div class="mt-3 flex space-x-2">
                            <button onclick="updatePatientStatus('${p.id}', 'Discharged')" class="text-xs px-2 py-1 bg-green-500 text-white rounded-md hover:bg-green-600">Discharge</button>
                            <button onclick="updatePatientStatus('${p.id}', 'Critical')" class="text-xs px-2 py-1 bg-red-500 text-white rounded-md hover:bg-red-600">Critical</button>
                            <button onclick="document.getElementById('patient-id-consultation').value='${p.id}'; document.getElementById('patient-name-consultation').value='${p.name}'; switchTab('Consultations')" class="text-xs px-2 py-1 bg-blue-500 text-white rounded-md hover:bg-blue-600">Add Consultation</button>
                        </div>` : '';

                const patientCard = `
                    <div class="bg-white p-4 rounded-lg shadow-md border-l-4 border-blue-500 mb-3">
                        <div class="flex justify-between items-center">
                            <p class="font-bold text-lg">${p.name} <span class="text-sm text-gray-500 ml-2">(ID: ${p.id.substring(0, 5)})</span></p>
                            <span class="px-3 py-1 text-xs font-semibold rounded-full ${statusColor}">${p.status}</span>
                        </div>
                        <p class="text-sm text-gray-600 mt-1">DOB: ${p.dob} | Contact: ${p.contact}</p>
                        <p class="text-xs text-gray-500">Admitted: ${new Date(p.admissionDate).toLocaleDateString()}</p>
                        ${actionsHtml}
                    </div>
                `;
                container.innerHTML += patientCard;
            });

            if (patients.length === 0) {
                 container.innerHTML = '<p class="text-center text-gray-400 p-8">No patients currently admitted.</p>';
            }
        };

        /** Renders the list of consultations */
        const renderConsultations = (consultations) => {
            const container = document.getElementById('consultations-list');
            container.innerHTML = '';

            if (consultations.length === 0) {
                 container.innerHTML = '<p class="text-gray-500 p-4">No consultations recorded yet.</p>';
                 return;
            }
            
            consultations.forEach(c => {
                const consultationCard = `
                    <div class="bg-white p-4 rounded-lg shadow-md border-l-4 border-green-500 mb-3">
                        <p class="font-bold text-md">Patient: ${c.patientName} <span class="text-sm font-normal text-gray-500 ml-2">(ID: ${c.patientId.substring(0, 5)})</span></p>
                        <p class="text-sm text-gray-700 mt-1">${c.notes}</p>
                        <p class="text-xs text-gray-500 mt-2">Recorded by: ${c.recordedBy.substring(0, 8)} on ${new Date(c.timestamp).toLocaleDateString()} at ${new Date(c.timestamp).toLocaleTimeString()}</p>
                    </div>
                `;
                container.innerHTML += consultationCard;
            });
        };

        /** Renders the inventory list */
        const renderInventory = (items) => {
            const container = document.getElementById('inventory-list');
            container.innerHTML = '';
            
            items.sort((a, b) => a.name.localeCompare(b.name)).forEach(item => {
                const stockColor = item.stock < 10 ? 'text-red-600 font-bold' : 'text-green-600';
                
                const actionsHtml = currentUserRole === 'Admin' ? `
                    <div class="w-1/6 flex justify-end space-x-2">
                        <button onclick="updateInventoryStock('${item.id}', 10)" class="text-xs px-2 py-1 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition-transform transform hover:scale-105">Add 10</button>
                        <button onclick="updateInventoryStock('${item.id}', -1)" class="text-xs px-2 py-1 bg-red-500 text-white rounded-md hover:bg-red-600 transition-transform transform hover:scale-105">Use 1</button>
                    </div>` : `<p class="w-1/6 text-center text-gray-400">View Only</p>`;

                const itemRow = `
                    <div class="flex justify-between items-center p-3 border-b border-gray-100 hover:bg-gray-50">
                        <p class="font-medium w-1/3">${item.name}</p>
                        <p class="w-1/3 text-center">Location: ${item.location}</p>
                        <p class="w-1/6 text-center ${stockColor}">Stock: ${item.stock}</p>
                        ${actionsHtml}
                    </div>
                `;
                container.innerHTML += itemRow;
            });
        };
        
        // --- Setup and Initialization ---

        /** Seeds initial inventory items if the collection is empty */
        const checkAndSeedInventory = async () => {
            // Only seed if user is Admin and data hasn't been loaded yet
            if (!isAuthReady || currentUserRole !== 'Admin') return; 

            const q = query(getPublicCollectionRef('inventory'));
            const snapshot = await getDocs(q);

            if (snapshot.empty) {
                console.log("Inventory is empty. Seeding initial data...");
                const initialItems = [
                    { name: 'Paracetamol', stock: 500, location: 'Pharmacy A' },
                    { name: 'IV Drip Solution', stock: 120, location: 'Storage 2' },
                    { name: 'Surgical Gloves (Box)', stock: 45, location: 'Storage 1' },
                    { name: 'Antibiotic X', stock: 80, location: 'Pharmacy B' },
                ];
                
                for (const item of initialItems) {
                    await addDoc(getPublicCollectionRef('inventory'), item);
                }
            }
        };

        /** Initializes Firebase and handles authentication. */
        const initFirebase = async () => {
            appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
            let firebaseConfig = null;
            let isAnon = false;
            const statusElement = document.getElementById('db-status');

            // Set initial status to indicate we are checking for config
            statusElement.textContent = "Status: Checking Firebase configuration...";
            statusElement.classList.add('text-yellow-600');


            // 1. Check for and parse the configuration string
            try {
                // Check if the global variable exists and is a non-empty string
                if (typeof __firebase_config !== 'undefined' && __firebase_config && __firebase_config.trim().length > 0) {
                    firebaseConfig = JSON.parse(__firebase_config);
                    console.log("SUCCESS: Found and parsed Firebase config string.");
                } else {
                    console.error("DEBUG: __firebase_config is undefined, null, or an empty string.");
                    // REDUNDANT CHECK: Sometimes the variable is present but empty, logging its type helps.
                    console.error("DEBUG: Type of __firebase_config:", typeof __firebase_config);
                }
            } catch (e) {
                console.error("CRITICAL ERROR: Failed to parse Firebase config string. Is it valid JSON?", e);
            }

            // 2. Critical Configuration Check
            if (!firebaseConfig || Object.keys(firebaseConfig).length === 0) {
                const message = "CRITICAL ERROR: Failed to connect to Firebase. Firebase configuration is missing or empty.";
                statusElement.textContent = message;
                statusElement.classList.remove('text-yellow-600');
                statusElement.classList.add('text-red-600', 'font-bold');
                console.error(message);
                
                // If the error persists, it is an environment issue, not a code issue.
                showMessage('CRITICAL ERROR', 'The Firebase configuration variable (__firebase_config) could not be loaded or was empty. Since your login page works, the issue is likely how the environment passes this configuration to the dashboard file. Please try reloading the page.', 'error');
                return; 
            }
            
            // 3. Initialize Firebase services
            try {
                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                setLogLevel('debug'); // Enable Firestore debug logging
                console.log("SUCCESS: Firebase App Initialized.");
            } catch(e) {
                console.error("ERROR: Failed to initialize Firebase App with config.", e);
                statusElement.textContent = "ERROR: Failed to initialize Firebase SDK.";
                statusElement.classList.remove('text-yellow-600');
                statusElement.classList.add('text-red-600', 'font-bold');
                return;
            }


            // 4. Handle Authentication
            if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                try {
                    await signInWithCustomToken(auth, __initial_auth_token);
                    console.log("SUCCESS: Signed in with custom token.");
                } catch (error) {
                    console.error("Custom token sign-in failed, falling back to anonymous:", error);
                    await signInAnonymously(auth);
                    isAnon = true;
                }
            } else {
                await signInAnonymously(auth);
                isAnon = true;
                console.log("INFO: Using anonymous sign-in (No initial token provided).");
            }
            
            // 5. Auth State Listener
            onAuthStateChanged(auth, (user) => {
                if (user) {
                    if (isAuthReady) return; 
                    
                    userId = user.uid;
                    initializeDashboard(appId, userId);
                    isAuthReady = true;

                    const roleText = isAnon ? 'Anonymous' : 'Authenticated';
                    const statusText = `Status: Logged in as ${roleText} | UID: ${userId}`;
                    statusElement.textContent = statusText;
                    statusElement.classList.remove('text-red-600', 'font-bold', 'text-yellow-600');
                    statusElement.classList.add('text-blue-600');

                } else {
                    console.warn("User state changed to logged out.");
                    statusElement.textContent = "Status: Not Authenticated. Cannot use database.";
                    statusElement.classList.remove('text-blue-600', 'text-yellow-600');
                    statusElement.classList.add('text-red-600');
                }
            });
        };

        // --- Event Handlers Setup ---
        window.onload = () => {
            initFirebase();
            
            // Patient Form Submission
            document.getElementById('patient-form').addEventListener('submit', (e) => {
                e.preventDefault();
                const name = document.getElementById('patient-name').value;
                const dob = document.getElementById('patient-dob').value;
                const contact = document.getElementById('patient-contact').value;
                addPatient(name, dob, contact);
            });

            // Consultation Form Submission
            document.getElementById('consultation-form').addEventListener('submit', (e) => {
                e.preventDefault();
                const patientId = document.getElementById('patient-id-consultation').value;
                const patientName = document.getElementById('patient-name-consultation').value;
                const notes = document.getElementById('consultation-notes').value;
                
                if (!patientId || !patientName) {
                    showMessage('Error', 'Please select a patient or manually enter the ID/Name.', 'error');
                    return;
                }
                addConsultation(patientId, patientName, notes);
            });

            // Make public functions available globally for inline HTML events
            window.updatePatientStatus = updatePatientStatus;
            window.updateInventoryStock = updateInventoryStock;
            window.switchTab = switchTab;
            window.hideMessage = hideMessage;
        };
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f4f7f9; }
        .tab-panel { min-height: 500px; }
    </style>
</head>
<body class="p-6">

    <!-- Message Modal (Replaces alert()) -->
    <div id="message-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="bg-white p-6 rounded-xl shadow-2xl max-w-sm w-full transform transition-all duration-300 scale-100">
            <h3 id="modal-title" class="text-xl font-semibold mb-2"></h3>
            <p id="modal-message" class="text-gray-700 mb-4"></p>
            <button onclick="hideMessage()" class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 font-medium transition duration-150">Close</button>
        </div>
    </div>

    <div class="max-w-4xl mx-auto bg-white p-8 rounded-2xl shadow-xl">
        <header class="mb-6 border-b pb-4">
            <h1 class="text-3xl font-bold text-gray-800">Clinic System Dashboard</h1>
            <div class="flex justify-between items-center text-sm mt-2 text-gray-600">
                <span id="db-status" class="text-xs font-mono text-blue-600">Initializing database...</span>
                <span id="current-role" class="px-3 py-1 bg-blue-100 text-blue-800 rounded-full font-semibold">Role: Loading...</span>
            </div>
            <div class="mt-1 text-xs text-gray-500">
                <p>UID is displayed for collaborative purposes. Initial role is set to **Nurse** for demonstration.</p>
            </div>
        </header>

        <!-- Tab Navigation -->
        <nav id="tab-navigation" class="flex border-b-2 border-blue-500 -mb-px space-x-2"></nav>

        <!-- Content Panels -->
        <div class="mt-4 border border-t-0 border-blue-500 p-4 rounded-b-lg bg-gray-50">
            
            <!-- Patients Panel -->
            <div id="panel-Patients" class="tab-panel">
                <h2 class="text-2xl font-semibold mb-4 text-blue-700">Patient Management</h2>
                
                <div class="grid md:grid-cols-2 gap-6">
                    <!-- New Patient Form -->
                    <div class="bg-white p-5 rounded-xl shadow-lg h-full">
                        <h3 class="text-xl font-semibold mb-3 text-gray-800">Admit New Patient</h3>
                        <form id="patient-form" class="space-y-3">
                            <input type="text" id="patient-name" placeholder="Patient Name" required class="w-full p-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                            <input type="date" id="patient-dob" placeholder="Date of Birth" required class="w-full p-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                            <input type="text" id="patient-contact" placeholder="Contact/Phone" required class="w-full p-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                            <button type="submit" class="w-full bg-blue-600 text-white py-2 rounded-lg font-semibold hover:bg-blue-700 transition duration-150 shadow-md">Admit Patient</button>
                        </form>
                    </div>

                    <!-- Patient List -->
                    <div class="h-full">
                        <h3 class="text-xl font-semibold mb-3 text-gray-800">Current Admissions</h3>
                        <div id="patients-list" class="space-y-3 max-h-96 overflow-y-auto pr-2">
                            <!-- Patients loaded here by renderPatients -->
                            <p class="text-center text-gray-400 p-8">Loading patient data...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Consultations Panel -->
            <div id="panel-Consultations" class="tab-panel hidden">
                <h2 class="text-2xl font-semibold mb-4 text-blue-700">Consultation Records</h2>

                <div class="grid md:grid-cols-2 gap-6">
                    <!-- New Consultation Form -->
                    <div class="bg-white p-5 rounded-xl shadow-lg h-full">
                        <h3 class="text-xl font-semibold mb-3 text-gray-800">Record New Consultation</h3>
                        <form id="consultation-form" class="space-y-3">
                            <input type="text" id="patient-id-consultation" placeholder="Patient ID (e.g. from above list)" required class="w-full p-2 border border-gray-300 rounded-lg">
                            <input type="text" id="patient-name-consultation" placeholder="Patient Name" required class="w-full p-2 border border-gray-300 rounded-lg">
                            <textarea id="consultation-notes" placeholder="Consultation Notes / Diagnosis / Prescription" rows="4" required class="w-full p-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"></textarea>
                            <button type="submit" class="w-full bg-yellow-600 text-white py-2 rounded-lg font-semibold hover:bg-yellow-700 transition duration-150 shadow-md">Save Consultation</button>
                        </form>
                    </div>

                    <!-- Consultation History List -->
                    <div class="h-full">
                        <h3 class="text-xl font-semibold mb-3 text-gray-800">Consultation History</h3>
                        <div id="consultations-list" class="space-y-3 max-h-96 overflow-y-auto pr-2">
                             <!-- Consultations loaded here by renderConsultations -->
                             <p class="text-center text-gray-400 p-8">Loading consultations...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Inventory Panel -->
            <div id="panel-Inventory" class="tab-panel hidden">
                <h2 class="text-2xl font-semibold mb-4 text-blue-700">Medical Inventory</h2>
                <p class="mb-4 text-gray-600">Admins can adjust stock levels. Nurses can view stock. Inventory is seeded if empty.</p>

                <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                    <div class="flex justify-between font-bold text-gray-700 bg-gray-100 p-3 border-b border-gray-200">
                        <p class="w-1/3">Item</p>
                        <p class="w-1/3 text-center">Location</p>
                        <p class="w-1/6 text-center">Stock</p>
                        <p class="w-1/6 text-right">Actions</p>
                    </div>
                    <div id="inventory-list" class="max-h-96 overflow-y-auto">
                        <!-- Inventory loaded here by renderInventory -->
                        <p class="text-center text-gray-400 p-8">Loading inventory...</p>
                    </div>
                </div>
            </div>
            
        </div>
    </div>
</body>
</html>
